# Chrome Tab Reader - HTTP API

> **Note:** This document is AI-authored with very limited human oversight.

REST API server for Chrome Tab Reader. Provides programmatic access to Chrome tab content extraction with token-based authentication.

## Table of Contents

- [Overview](#overview)
- [Quick Start](#quick-start)
- [API Endpoints](#api-endpoints)
- [Authentication](#authentication)
- [Usage Examples](#usage-examples)
- [API Documentation](#api-documentation)
- [Configuration](#configuration)
- [Troubleshooting](#troubleshooting)

---

## Overview

The Chrome Tab Reader HTTP API provides a FastAPI-based REST interface for extracting and processing Chrome tab content.

### Key Features

- **FastAPI Framework** - Modern, fast Python web framework
- **Automatic OpenAPI 3.0 Specification** - Self-documenting API
- **Interactive Documentation** - Swagger UI and ReDoc interfaces
- **Token-Based Authentication** - Secure OAuth2 bearer token pattern
- **Three-Phase Content Extraction** - Leverages extension's extraction pipeline
- **Cross-Platform** - Works on Windows, macOS, Linux

### When to Use HTTP API

Use the HTTP API when you need:
- Programmatic access from scripts or applications
- RESTful interface for integration with other services
- Direct HTTP endpoint access without MCP protocol
- Testing or debugging content extraction

**Note:** For AI assistant integration, use the [MCP Server](README_MCP.md) instead - it's optimized for that use case.

---

## Quick Start

### Prerequisites

- Chrome Tab Reader extension installed (see main [README.md](README.md))
- Python 3.8+
- uv (recommended) or pip

### Step 1: Get Access Token

```bash
# Click the Chrome Tab Reader extension icon
# Your access token is shown at the top of the popup
# Click "Copy JSON" or "Download Config File"
```

### Step 2: Configure Authentication

```bash
# Option A: Use setup script
./setup_token.sh

# Option B: Manual configuration
# Create tokens.json in platform-specific location:
# - Linux: ~/.config/chrome-tab-reader/tokens.json
# - macOS: ~/Library/Application Support/chrome-tab-reader/tokens.json
# - Windows: %APPDATA%\chrome-tab-reader\tokens.json
```

**tokens.json format:**
```json
{
  "tokens": ["your-token-from-extension-here"]
}
```

### Step 3: Start HTTP Server

```bash
# Option A: Using uv (recommended)
uv run chrome_tab_http_server.py

# Option B: Using pip
pip install -r requirements.txt
python chrome_tab_http_server.py
```

Server starts on `http://localhost:8888` (localhost only for security).

### Step 4: Test the API

```bash
# Health check
curl -H "Authorization: Bearer YOUR_TOKEN" \
     http://localhost:8888/api/health

# Expected response:
# {"status": "healthy", "service": "Chrome Tab Reader HTTP API"}
```

---

## API Endpoints

### Authentication

All endpoints require Bearer token authentication:

```
Authorization: Bearer YOUR_TOKEN_HERE
```

### Available Endpoints

#### `GET /api/health`

Health check endpoint.

**Response:**
```json
{
  "status": "healthy",
  "service": "Chrome Tab Reader HTTP API"
}
```

---

#### `GET /api/current_tab`

Get information about the current Chrome tab.

**Response:**
```json
{
  "status": "success",
  "title": "Example Page Title",
  "url": "https://example.com",
  "tabId": 12345
}
```

---

#### `POST /api/extract`

Extract content from Chrome tab.

**Request Body:**
```json
{
  "action": "extract_current_tab",
  "strategy": "three-phase"
}
```

**Parameters:**
- `action` (string): Action to perform
  - `"extract_current_tab"` - Extract from active tab
- `strategy` (string): Extraction strategy
  - `"three-phase"` - Full extraction (lazy-loading + DOM stability + Readability)
  - `"immediate"` - Fast extraction (Readability only)

**Response:**
```json
{
  "status": "success",
  "content": "Extracted page content...",
  "title": "Page Title",
  "url": "https://example.com",
  "length": 15234
}
```

---

### Error Responses

All errors follow this format:

```json
{
  "detail": "Error description"
}
```

**Common HTTP Status Codes:**
- `200` - Success
- `401` - Unauthorized (invalid or missing token)
- `422` - Unprocessable Entity (invalid request body)
- `500` - Internal Server Error

---

## Authentication

### Token Generation

Tokens are automatically generated by the Chrome extension on first install:

1. Install the extension
2. Open the extension popup
3. Copy the displayed token

Tokens are:
- **256-bit random values** - Cryptographically secure
- **Base64 encoded** - URL-safe format
- **Stored in Chrome** - Persistent across sessions

### Token Configuration

**Platform-Specific Locations:**

| Platform | Path |
|----------|------|
| Linux | `~/.config/chrome-tab-reader/tokens.json` |
| macOS | `~/Library/Application Support/chrome-tab-reader/tokens.json` |
| Windows | `%APPDATA%\chrome-tab-reader\tokens.json` |

**tokens.json Format:**
```json
{
  "tokens": [
    "first-token-here",
    "second-token-here"
  ]
}
```

### Multiple Tokens

You can configure multiple tokens for different clients:

```json
{
  "tokens": [
    "token-for-script-a",
    "token-for-script-b",
    "token-for-testing"
  ]
}
```

### Security Best Practices

- ✅ **Never commit tokens to version control**
- ✅ **Use different tokens for different applications**
- ✅ **Rotate tokens periodically**
- ✅ **Store tokens securely** (environment variables, secret managers)
- ✅ **Server binds to localhost only** (no external access)

See [ACCESS_CONTROL_SETUP.md](ACCESS_CONTROL_SETUP.md) for detailed security guidance.

---

## Usage Examples

### Bash/cURL

```bash
# Set your token
export CHROME_TAB_TOKEN="your-token-here"

# Health check
curl -H "Authorization: Bearer $CHROME_TAB_TOKEN" \
     http://localhost:8888/api/health

# Get current tab info
curl -H "Authorization: Bearer $CHROME_TAB_TOKEN" \
     http://localhost:8888/api/current_tab

# Extract content (three-phase)
curl -X POST \
     -H "Authorization: Bearer $CHROME_TAB_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"action": "extract_current_tab", "strategy": "three-phase"}' \
     http://localhost:8888/api/extract

# Extract content (immediate - faster)
curl -X POST \
     -H "Authorization: Bearer $CHROME_TAB_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"action": "extract_current_tab", "strategy": "immediate"}' \
     http://localhost:8888/api/extract
```

---

### Python

```python
import requests
import os

# Configuration
BASE_URL = "http://localhost:8888"
TOKEN = os.environ.get("CHROME_TAB_TOKEN")

headers = {
    "Authorization": f"Bearer {TOKEN}",
    "Content-Type": "application/json"
}

# Health check
response = requests.get(f"{BASE_URL}/api/health", headers=headers)
print(response.json())

# Get current tab
response = requests.get(f"{BASE_URL}/api/current_tab", headers=headers)
tab_info = response.json()
print(f"Current tab: {tab_info['title']}")

# Extract content
response = requests.post(
    f"{BASE_URL}/api/extract",
    headers=headers,
    json={
        "action": "extract_current_tab",
        "strategy": "three-phase"
    }
)

if response.status_code == 200:
    data = response.json()
    print(f"Extracted {data['length']} characters")
    print(f"Content preview: {data['content'][:200]}...")
else:
    print(f"Error: {response.status_code}")
    print(response.text)
```

---

### JavaScript/Node.js

```javascript
const axios = require('axios');

const BASE_URL = 'http://localhost:8888';
const TOKEN = process.env.CHROME_TAB_TOKEN;

const headers = {
  'Authorization': `Bearer ${TOKEN}`,
  'Content-Type': 'application/json'
};

// Health check
async function healthCheck() {
  const response = await axios.get(`${BASE_URL}/api/health`, { headers });
  console.log(response.data);
}

// Get current tab
async function getCurrentTab() {
  const response = await axios.get(`${BASE_URL}/api/current_tab`, { headers });
  console.log(`Current tab: ${response.data.title}`);
  return response.data;
}

// Extract content
async function extractContent() {
  const response = await axios.post(
    `${BASE_URL}/api/extract`,
    {
      action: 'extract_current_tab',
      strategy: 'three-phase'
    },
    { headers }
  );

  const data = response.data;
  console.log(`Extracted ${data.length} characters`);
  console.log(`Content preview: ${data.content.substring(0, 200)}...`);
  return data;
}

// Run example
(async () => {
  await healthCheck();
  await getCurrentTab();
  await extractContent();
})();
```

---

## API Documentation

The HTTP server provides automatic interactive documentation:

### Swagger UI

**URL:** http://localhost:8888/docs

Features:
- Interactive API explorer
- Try endpoints directly in browser
- Request/response examples
- Schema definitions

### ReDoc

**URL:** http://localhost:8888/redoc

Features:
- Clean, readable documentation
- Organized by tags
- Detailed schema descriptions
- Search functionality

### OpenAPI Specification

**URL:** http://localhost:8888/openapi.json

- Machine-readable API specification
- OpenAPI 3.0 format
- Use with code generators, testing tools, etc.

---

## Configuration

### Server Settings

The HTTP server can be configured via environment variables:

| Variable | Default | Description |
|----------|---------|-------------|
| `HOST` | `127.0.0.1` | Server bind address (localhost only for security) |
| `PORT` | `8888` | Server port |
| `RELOAD` | `False` | Auto-reload on code changes (development) |

### Running in Development Mode

```bash
# Auto-reload on code changes
uvicorn chrome_tab_http_server:app --reload

# Custom port
uvicorn chrome_tab_http_server:app --port 9000

# Accessible from network (⚠️ security risk)
uvicorn chrome_tab_http_server:app --host 0.0.0.0
```

### Production Deployment

For production deployments:

```bash
# Install uvicorn with performance extras
pip install uvicorn[standard]

# Run with multiple workers
uvicorn chrome_tab_http_server:app \
  --workers 4 \
  --host 127.0.0.1 \
  --port 8888
```

**Security Note:** Always bind to `127.0.0.1` (localhost) unless you have proper authentication and network security in place.

---

## Troubleshooting

### Error: 401 Unauthorized

**Cause:** Token not configured or invalid

**Solution:**
```bash
# 1. Get token from extension
# Click extension icon, copy token

# 2. Verify tokens.json exists and contains your token
cat ~/.config/chrome-tab-reader/tokens.json

# 3. Ensure proper format
{
  "tokens": ["your-token-here"]
}

# 4. Restart HTTP server
# Stop server (Ctrl+C)
uv run chrome_tab_http_server.py
```

---

### Error: Connection Refused

**Cause:** HTTP server not running

**Solution:**
```bash
# Check if server is running
curl http://localhost:8888/api/health

# If not running, start it
uv run chrome_tab_http_server.py
```

---

### Error: Cannot connect to extension

**Cause:** Chrome not running or extension not loaded

**Solution:**
```bash
# 1. Start Chrome browser

# 2. Verify extension is loaded
# Open chrome://extensions/
# Look for "Chrome Tab Reader" with green checkmark

# 3. Reload extension if needed
# Click reload icon in chrome://extensions/
```

---

### Error: Empty content returned

**Cause:** Page not loaded or extraction failed

**Solution:**
```bash
# 1. Ensure page is fully loaded in Chrome
# Wait for page to finish loading

# 2. Try immediate strategy (faster, less thorough)
curl -X POST \
     -H "Authorization: Bearer $TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"action": "extract_current_tab", "strategy": "immediate"}' \
     http://localhost:8888/api/extract

# 3. Check Chrome DevTools console for errors
# Open DevTools (F12), look for extension errors
```

---

### Error: Port 8888 already in use

**Cause:** Another service using port 8888

**Solution:**
```bash
# Option A: Use different port
uvicorn chrome_tab_http_server:app --port 9000

# Option B: Find and stop conflicting service
# Linux/macOS
lsof -i :8888

# Windows
netstat -ano | findstr 8888
```

---

## Advanced Topics

### Custom Extraction Strategies

The API supports two extraction strategies:

**Three-Phase (Recommended):**
- Triggers lazy-loading (scroll simulation)
- Waits for DOM stability (dynamic content)
- Extracts with Readability.js (clean content)
- **Pros:** Most complete, handles complex pages
- **Cons:** Slower (2-35 seconds)

**Immediate (Fast):**
- Readability.js extraction only
- No lazy-loading or DOM waiting
- **Pros:** Fast (< 1 second)
- **Cons:** May miss lazy-loaded content

```bash
# Use three-phase for complex pages (SPAs, infinite scroll)
curl -X POST ... -d '{"strategy": "three-phase"}' ...

# Use immediate for simple articles or speed
curl -X POST ... -d '{"strategy": "immediate"}' ...
```

### Rate Limiting

The HTTP server does not implement rate limiting by default. For production use:

```python
# Add rate limiting with slowapi or similar
from slowapi import Limiter
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)

@app.get("/api/extract")
@limiter.limit("10/minute")
async def extract_endpoint():
    ...
```

### CORS Configuration

For browser-based clients, enable CORS:

```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],  # Your frontend
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

## Related Documentation

- [Main README](README.md) - Project overview and setup
- [MCP Server Guide](README_MCP.md) - MCP server documentation
- [Access Control Setup](ACCESS_CONTROL_SETUP.md) - Token authentication
- [Extension Architecture](extension/ARCHITECTURE.md) - Extension internals
- [CLAUDE.md](CLAUDE.md) - AI assistant development guide

---

## Support

For issues or questions:

1. **Check tokens.json**: Verify token is correctly configured
2. **Check server logs**: Look for error messages in terminal
3. **Check extension**: Ensure extension is loaded in Chrome
4. **GitHub Issues**: [chrome-tab-mcp/issues](https://github.com/russellpierce/chrome-tab-mcp/issues)

---

**Last Updated:** 2025-11-18
**Version:** 1.0
**Author:** Russell Pierce (with AI assistance)
